<!DOCTYPE html>
<html lang="ru" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BoxMonitor | Future</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Manrope', 'sans-serif'],
              mono: ['"JetBrains Mono"', 'monospace'],
            },
            colors: {
              glass: {
                100: 'rgba(255, 255, 255, 0.03)',
                200: 'rgba(255, 255, 255, 0.05)',
                300: 'rgba(255, 255, 255, 0.1)',
              },
              neon: {
                purple: '#a855f7',
                cyan: '#06b6d4',
                success: '#4ade80'
              }
            },
            animation: {
              'blob': 'blob 10s infinite',
              'fade-in': 'fadeIn 0.5s ease-out forwards',
              'pop': 'pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
              'scan': 'scan 2s linear infinite',
              'jump-scare': 'jumpScare 0.15s cubic-bezier(0, 0, 0.2, 1) forwards',
            },
            keyframes: {
              blob: {
                '0%': { transform: 'translate(0px, 0px) scale(1)' },
                '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                '100%': { transform: 'translate(0px, 0px) scale(1)' },
              },
              fadeIn: {
                '0%': { opacity: '0', transform: 'translateY(20px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              },
              pop: {
                '0%': { transform: 'scale(1)' },
                '50%': { transform: 'scale(1.5)' },
                '100%': { transform: 'scale(1)' },
              },
              scan: {
                '0%': { transform: 'translateY(-100%)' },
                '100%': { transform: 'translateY(500%)' },
              },
              jumpScare: {
                '0%': { opacity: '0', transform: 'scale(0.8) rotate(-5deg)' },
                '70%': { opacity: '1', transform: 'scale(1.1) rotate(2deg)' },
                '100%': { opacity: '1', transform: 'scale(1) rotate(0deg)' },
              }
            }
          }
        }
      }
    </script>
    <style>
      body {
        background-color: #020617;
        color: #f8fafc;
        overflow-x: hidden;
      }
      
      .mesh-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: -2;
        background: radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                    radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                    radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
        opacity: 0.6;
      }

      .grid-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: -1;
        background-size: 40px 40px;
        background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                          linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        -webkit-mask-image: radial-gradient(circle at 50% 50%, black 40%, transparent 90%);
        mask-image: radial-gradient(circle at 50% 50%, black 40%, transparent 90%);
        pointer-events: none;
      }
      
      .noise-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: -1;
        opacity: 0.03;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        pointer-events: none;
      }
      
      .mesh-blob {
        position: absolute;
        filter: blur(80px);
        opacity: 0.4;
        z-index: -2;
        animation: blob 10s infinite;
      }

      /* Custom Animation Delays */
      .animation-delay-2000 { animation-delay: 2s; }
      .animation-delay-4000 { animation-delay: 4s; }

      /* Clean Scrollbar */
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
      ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

      .vertical-text {
        writing-mode: vertical-rl;
        text-orientation: mixed;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react": "https://esm.sh/react@^19.2.4",
    "react/": "https://esm.sh/react@^19.2.4/",
    "lucide-react": "https://esm.sh/lucide-react@^0.563.0"
  }
}
</script>
</head>
  <body>
    <div class="mesh-bg"></div>
    <div class="grid-bg"></div>
    <div class="noise-bg"></div>
    <div class="mesh-blob bg-purple-500 w-96 h-96 rounded-full top-0 left-1/4 mix-blend-multiply"></div>
    <div class="mesh-blob bg-blue-500 w-96 h-96 rounded-full top-0 right-1/4 mix-blend-multiply animation-delay-2000"></div>
    <div class="mesh-blob bg-pink-500 w-96 h-96 rounded-full bottom-0 left-1/3 mix-blend-multiply animation-delay-4000"></div>
    
    <div id="root"></div>

    <!-- MAIN APP LOGIC -->
    <script type="text/babel">
      // --- GLOBALS & DESTRUCTURING ---
      const { useState, useEffect, useRef, useMemo } = React;
      const { createRoot } = ReactDOM;

      // --- INLINE ICONS (To remove external dependency issues) ---
      const IconWrapper = ({ children, size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
      );
      
      const Copy = (props) => <IconWrapper {...props}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></IconWrapper>;
      const Check = (props) => <IconWrapper {...props}><polyline points="20 6 9 17 4 12"/></IconWrapper>;
      const Star = (props) => <IconWrapper {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></IconWrapper>;
      const Crown = (props) => <IconWrapper {...props}><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></IconWrapper>;
      const Users = (props) => <IconWrapper {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconWrapper>;
      const Activity = (props) => <IconWrapper {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></IconWrapper>;
      const Globe = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></IconWrapper>;
      const RefreshCw = (props) => <IconWrapper {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconWrapper>;
      const Search = (props) => <IconWrapper {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconWrapper>;
      const ArrowDownUp = (props) => <IconWrapper {...props}><path d="m3 16 4 4 4-4"/><path d="M7 20V4"/><path d="m21 8-4-4-4 4"/><path d="M17 4v16"/></IconWrapper>;
      const Zap = (props) => <IconWrapper {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconWrapper>;
      const SlidersHorizontal = (props) => <IconWrapper {...props}><line x1="21" x2="14" y1="4" y2="4"/><line x1="10" x2="3" y1="4" y2="4"/><line x1="21" x2="12" y1="12" y2="12"/><line x1="8" x2="3" y1="12" y2="12"/><line x1="21" x2="16" y1="20" y2="20"/><line x1="12" x2="3" y1="20" y2="20"/><line x1="14" x2="14" y1="2" y2="6"/><line x1="8" x2="8" y1="10" y2="14"/><line x1="16" x2="16" y1="18" y2="22"/></IconWrapper>;
      const Trophy = (props) => <IconWrapper {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></IconWrapper>;
      const Hexagon = (props) => <IconWrapper {...props}><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></IconWrapper>;

      // --- CONSTANTS ---
      
      const SUREBOX_IMAGE = "https://i.ibb.co/d0cqRRCz/image.png"; 
      const RESERVBOX_VIDEO = "./video_2026-02-01_03-53-39.mp4"; 

      const MOCK_SERVERS = [
        {
            id: 'godbox',
            name: 'GodBox',
            ip: 'mc.godbox.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Божественный сервер с эпическими возможностями',
            motd: 'Loading...'
        },
        {
            id: 'sunbox',
            name: 'SunBox',
            ip: 'Play.sun-box.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Солнечный и яркий мир BoxPvP',
            motd: 'Loading...'
        },
        {
            id: 'spinbox',
            name: 'SpinBox',
            ip: 'play.spinbox.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Популярный русский бокс с мини-играми',
            motd: 'Loading...'
        },
        {
            id: 'moonbox',
            name: 'MoonBox',
            ip: 'play.moonbox.pw',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Лунный бокс с уникальными режимами',
            motd: 'Loading...'
        },
        {
            id: 'surebox',
            name: 'SureBox',
            ip: 'play.surebox.pro',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Надежный бокс с стабильным онлайн',
            motd: 'Loading...'
        },
        {
            id: 'seasonbox',
            name: 'Season Box',
            ip: 'mc.season-box.ru',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Сезонный бокс с регулярными обновлениями',
            motd: 'Loading...'
        },
        {
            id: 'soulbox',
            name: 'SoulBox',
            ip: 'play.soulbox.pw',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Бокс с атмосферными режимами',
            motd: 'Loading...'
        },
        {
            id: 'TurboBox',
            name: 'TurboBox',
            ip: 'mc.turbobox.pro',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Бокс с расширенными горизонтами',
            motd: 'Loading...'
        },
        {
            id: 'grandbox',
            name: 'GrandBox',
            ip: 'mc.grandbox.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Грандиозный бокс с масштабными ивентами',
            motd: 'Loading...'
        },
        {
            id: 'infernobox',
            name: 'InfernoBox',
            ip: 'infernobox.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Огненный бокс с интенсивными баталиями',
            motd: 'Loading...'
        },
        {
            id: 'glorytime',
            name: 'GloryTime',
            ip: 'mc.glorytime.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Бокс славного времени с эксклюзивными режимами',
            motd: 'Loading...'
        },
        {
            id: 'ultimatebox',
            name: 'UltimateBox',
            ip: 'play.ultimatebox.pro',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Ультимативный бокс с премиум контентом',
            motd: 'Loading...'
        },
        {
            id: 'richworld',
            name: 'RichWorld',
            ip: 'Play.RichWorld.me',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Богатый мир с уникальной экономикой',
            motd: 'Loading...'
        },
        {
            id: 'reservbox',
            name: 'ReservBox',
            ip: 'play.reserv.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Резервный бокс с эксклюзивными ивентами',
            motd: 'Loading...'
        },
        {
            id: 'serobox',
            name: 'SeroBox',
            ip: 'play.serobox.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Серый бокс с классическими режимами',
            motd: 'Loading...'
        },
        {
            id: 'icebox',
            name: 'IceBox',
            ip: 'mc.iceboxs.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Ледяной бокс с холодными баталиями',
            motd: 'Loading...'
        },
        {
            id: 'boxpvp',
            name: 'BoxPvP',
            ip: 'play.boxpvpava.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Бокс для любителей PvP сражений',
            motd: 'Loading...'
        },
        {
            id: 'powerbox',
            name: 'PowerBox',
            ip: 'play.powerbox.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Мощный бокс с усиленными возможностями',
            motd: 'Loading...'
        },
        {
            id: 'netherbox',
            name: 'NetherBox',
            ip: 'mc.nether.day',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Адский бокс с тематикой Незера',
            motd: 'Loading...'
        },
        {
            id: 'hollbox',
            name: 'HollBox',
            ip: 'mc.hollbox.xyz',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Полый бокс с уникальной архитектурой',
            motd: 'Loading...'
        },
        {
            id: 'starbox',
            name: 'StarBox',
            ip: 'mc.starbox.lol',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Звездный бокс с космическими приключениями',
            motd: 'Loading...'
        },
        {
            id: 'justbox',
            name: 'JustBox',
            ip: 'play.just-box.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Простой и удобный бокс для всех',
            motd: 'Loading...'
        },
        {
            id: 'InfinityBox',
            name: 'InfinityBox',
            ip: 'play.InfinityBox.pro',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Простой и удобный бокс для всех',
            motd: 'Loading...'
        },
        {
            id: 'LoonBox',
            name: 'LoonBox',
            ip: 'loonbox.pw',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Бесконечный бокс с безграничными возможностями',
            motd: 'Loading...'
        },
        {
            id: 'elybox',
            name: 'ElyBox',
            ip: 'elybox.pro',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Элитный бокс с премиум качеством',
            motd: 'Loading...'
        },
        {
            id: 'stellarbox',
            name: 'StellarBox',
            ip: 'play.stellarbox.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Космический бокс с уникальными планетами',
            motd: 'Loading...'
        },
        {
            id: 'neverbox',
            name: 'NeverBox',
            ip: 'neverbox.lol',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Уникальный бокс сервер с крутыми ивентами',
            motd: 'Loading...'
        },
        {
            id: 'overbox',
            name: 'overbox',
            ip: 'play.overbox.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Уникальный бокс сервер с крутыми ивентами',
            motd: 'Loading...'
        },
        {
            id: 'wildbox',
            name: 'WildBox',
            ip: 'play.wildbox.fun',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Дикий бокс с суровым выживанием',
            motd: 'Loading...'
        },
        {
            id: 'novacube',
            name: 'NovaCube',
            ip: 'mc.novacube.space',
            port: 25565,
            players: 0,
            maxPlayers: 1000,
            version: '1.16+',
            status: 'offline',
            description: 'Космический куб с новыми технологиями',
            motd: 'Loading...'
        }
      ];

      // --- SERVICES ---

      const fetchServerStatus = async (server) => {
        try {
          // Primary API: mcstatus.io
          const response = await fetch(`https://api.mcstatus.io/v2/status/java/${server.ip}`);
          const data = await response.json();

          if (response.ok && data) {
            if (data.online) {
              const cleanMotd = data.motd?.clean 
                ? (Array.isArray(data.motd.clean) ? data.motd.clean.join(' ') : data.motd.clean) 
                : server.motd;

              return {
                status: 'online',
                players: data.players.online,
                maxPlayers: data.players.max,
                version: data.version?.name_clean || data.version?.name || server.version,
                motd: cleanMotd,
                favicon: data.icon,
              };
            } else {
              return { status: 'offline', players: 0 };
            }
          }
        } catch (error) {
          // console.warn(`mcstatus.io failed for ${server.ip}`, error);
        }

        try {
          // Fallback API: mcsrvstat.us
          const response = await fetch(`https://api.mcsrvstat.us/3/${server.ip}`);
          const data = await response.json();

          if (data.online) {
            const cleanMotd = data.motd?.clean 
                ? (Array.isArray(data.motd.clean) ? data.motd.clean.join(' ') : data.motd.clean) 
                : server.motd;

            return {
              status: 'online',
              players: data.players.online,
              maxPlayers: data.players.max,
              version: data.version || server.version,
              motd: cleanMotd,
              favicon: data.icon,
            };
          } else {
             return { status: 'offline', players: 0 };
          }
        } catch (e) {
          // console.error(`All APIs failed for ${server.ip}`, e);
        }
        return { status: 'offline', players: 0 };
      };

      // --- COMPONENTS ---

      const ServerCard = ({ server, index, isFavorite, onToggleFavorite, rank }) => {
        const [copied, setCopied] = useState(false);
        const [isAnimatingFav, setIsAnimatingFav] = useState(false);
        
        // Easter Egg States
        const [easterEggType, setEasterEggType] = useState(null);
        const [hasTriggered, setHasTriggered] = useState(false);
        
        const videoRef = useRef(null);
        const isOnline = server.status === 'online';

        const copyIp = (e) => {
          e.stopPropagation();
          navigator.clipboard.writeText(server.ip);
          setCopied(true);
          setTimeout(() => setCopied(false), 2000);
        };

        const handleFavoriteClick = (e) => {
          e.stopPropagation();
          setIsAnimatingFav(true);
          onToggleFavorite(server.id);
          setTimeout(() => setIsAnimatingFav(false), 400); 
        };

        // Easter Egg Logic
        const handleMouseEnter = () => {
          if (hasTriggered) return;

          if (server.name === 'SureBox') {
            setEasterEggType('image');
            setHasTriggered(true); 
          } else if (server.name === 'ReservBox') {
            setEasterEggType('video');
            setHasTriggered(true); 
          }
        };

        const handleMouseLeave = () => {
          setEasterEggType(null);
          if (videoRef.current) {
            videoRef.current.pause();
            videoRef.current.currentTime = 0;
          }
        };

        useEffect(() => {
          if (easterEggType === 'video' && videoRef.current) {
            videoRef.current.volume = 1.0;
            const playPromise = videoRef.current.play();
            if (playPromise !== undefined) {
              playPromise.catch(error => {
                console.log("Autoplay prevented:", error);
              });
            }
          }
        }, [easterEggType]);

        const fillPercentage = Math.min((server.players / server.maxPlayers) * 100, 100);

        const getCardStyles = () => {
          if (rank === 1) return 'shadow-[0_0_50px_-15px_rgba(234,179,8,0.3)] border-yellow-500/30 bg-yellow-900/10 backdrop-blur-md';
          if (rank === 2) return 'border-slate-400/30 bg-slate-800/20 backdrop-blur-md';
          if (rank === 3) return 'border-orange-700/30 bg-orange-900/10 backdrop-blur-md';

          if (isFavorite) {
            return 'border-yellow-500/20 bg-yellow-500/[0.02] shadow-[0_0_25px_-5px_rgba(234,179,8,0.1)]';
          }

          return isOnline 
            ? 'bg-glass-200 hover:bg-glass-300 border border-white/5 hover:border-white/20 shadow-lg hover:shadow-2xl hover:shadow-purple-900/10' 
            : 'bg-white/[0.02] border border-white/[0.02] opacity-50 hover:opacity-80 grayscale transition-all duration-500';
        };

        return (
          <React.Fragment>
            {easterEggType && (
              <div className="fixed inset-0 z-[9999] flex items-center justify-center pointer-events-none">
                 <div className="absolute inset-0 bg-black/95 animate-fade-in duration-75"></div>
                 <div className="relative z-10 w-full h-full flex items-center justify-center animate-jump-scare">
                    {easterEggType === 'image' ? (
                      <img 
                        src={SUREBOX_IMAGE} 
                        alt="SURPRISE" 
                        className="w-full h-full object-contain"
                      />
                    ) : (
                      <video
                        ref={videoRef}
                        src={RESERVBOX_VIDEO}
                        className="w-full h-full object-contain"
                        loop
                        playsInline
                      />
                    )}
                 </div>
              </div>
            )}

            <div 
              onMouseEnter={handleMouseEnter}
              onMouseLeave={handleMouseLeave}
              className={`group relative rounded-3xl p-6 transition-all duration-500 overflow-hidden ${getCardStyles()}`}
              style={{ 
                animation: `fadeIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards ${index * 50}ms`,
                opacity: 0,
                transform: 'translateY(20px)'
              }}
            >
              <div className="absolute top-0 left-0 w-full h-[10px] bg-gradient-to-b from-transparent via-white/10 to-transparent opacity-0 group-hover:animate-scan pointer-events-none blur-sm"></div>

              {!rank && !isFavorite && (
                <div className="absolute -inset-1 bg-gradient-to-br from-purple-500/0 via-purple-500/0 to-blue-500/0 group-hover:from-purple-500/10 group-hover:to-blue-500/10 transition-all duration-700 opacity-0 group-hover:opacity-100 rounded-3xl blur-2xl"></div>
              )}

              {isFavorite && !rank && (
                <div className="absolute inset-0 bg-gradient-to-tr from-yellow-500/[0.05] to-transparent pointer-events-none"></div>
              )}

              {rank && (
                <div className={`absolute top-0 left-0 px-4 py-1.5 rounded-br-2xl text-[10px] font-bold font-mono z-20 shadow-lg tracking-widest
                  ${rank === 1 ? 'bg-yellow-500 text-black' : 
                    rank === 2 ? 'bg-slate-400 text-black' : 
                    'bg-orange-700 text-white'}
                `}>
                  #{rank}
                </div>
              )}

              <div className="relative z-10 flex flex-col h-full">
                
                <div className="flex justify-between items-start mb-6 pt-1">
                  <div className="flex items-center gap-4">
                    <div className={`relative w-12 h-12 rounded-xl flex items-center justify-center overflow-hidden bg-white/5 border border-white/10 group-hover:border-white/20 transition-all duration-500 ${isOnline ? 'shadow-[0_0_20px_-5px_rgba(255,255,255,0.15)]' : ''}`}>
                        {server.favicon ? (
                          <img src={server.favicon} alt={server.name} className="w-full h-full object-cover" />
                        ) : (
                          <span className="text-lg font-bold text-white/20">{server.name.charAt(0)}</span>
                        )}
                        <div className={`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-[#1a1a2e] z-10 ${isOnline ? 'bg-green-400 group-hover:animate-pulse' : 'bg-red-500/50'}`}></div>
                    </div>

                    <div>
                        <h3 className={`text-lg font-bold tracking-tight leading-tight transition-colors duration-300 ${isFavorite ? 'text-yellow-50' : 'text-white group-hover:text-purple-100'}`}>
                          {server.name}
                        </h3>
                        <span className="text-[10px] font-medium tracking-wider text-white/30 uppercase block mt-0.5 group-hover:text-white/50 transition-colors">
                          {isOnline ? server.version : 'Оффлайн'}
                        </span>
                    </div>
                  </div>

                  <button 
                    onClick={handleFavoriteClick}
                    className={`p-1.5 rounded-full transition-all duration-300 hover:bg-white/10 active:scale-90
                      ${isAnimatingFav ? 'animate-pop' : ''}
                      ${isFavorite ? 'text-yellow-400 drop-shadow-[0_0_10px_rgba(250,204,21,0.5)]' : 'text-white/5 hover:text-white/40'}
                    `}
                  >
                    <Star size={18} className={isFavorite ? "fill-current" : ""} />
                  </button>
                </div>

                {rank === 1 && (
                  <div className="absolute top-4 right-14 opacity-20 rotate-12 pointer-events-none">
                      <Crown size={48} className="text-yellow-500" />
                  </div>
                )}

                <div className="mt-auto space-y-4">
                  <div className="flex items-baseline gap-1.5">
                      <span className={`text-3xl font-bold tracking-tighter ${isOnline ? 'text-white' : 'text-white/20'}`}>
                        {server.players}
                      </span>
                      <span className="text-xs font-medium text-white/30">
                        / {server.maxPlayers}
                      </span>
                  </div>

                  <div className="h-1.5 w-full bg-white/5 rounded-full overflow-hidden backdrop-blur-sm">
                      <div 
                        className={`h-full rounded-full transition-all duration-1000 
                          ${isOnline 
                              ? (rank === 1 || isFavorite ? 'bg-yellow-500 shadow-[0_0_15px_orange]' : 'bg-gradient-to-r from-purple-500 to-blue-500') 
                              : 'bg-white/5'}
                        `}
                        style={{ width: `${fillPercentage}%` }}
                      ></div>
                  </div>

                  <button 
                    onClick={copyIp}
                    className={`w-full py-2.5 px-3 rounded-xl flex items-center justify-between text-xs font-medium transition-all group/btn
                      ${copied 
                        ? 'bg-green-500/20 text-green-300 border border-green-500/30' 
                        : (isFavorite 
                            ? 'bg-yellow-500/10 hover:bg-yellow-500/20 text-yellow-200/70 hover:text-yellow-100 border border-yellow-500/10'
                            : 'bg-white/5 hover:bg-white/10 text-white/40 hover:text-white border border-transparent')
                      }
                    `}
                  >
                      <span className="truncate pr-2 font-mono opacity-80 group-hover/btn:opacity-100 transition-opacity">{server.ip}</span>
                      {copied ? <Check size={14} /> : <Copy size={14} className="opacity-50 group-hover/btn:opacity-100 transition-opacity" />}
                  </button>
                </div>

              </div>
            </div>
          </React.Fragment>
        );
      };

      // --- MAIN APP ---

      const App = () => {
        const [servers, setServers] = useState(MOCK_SERVERS);
        const [favorites, setFavorites] = useState([]);
        const [isRefreshing, setIsRefreshing] = useState(false);
        
        const [sortOption, setSortOption] = useState('online_desc');
        const [filters, setFilters] = useState({ minPlayers: 0, showOffline: true });
        const [searchTerm, setSearchTerm] = useState('');
        
        useEffect(() => {
          const saved = localStorage.getItem('boxmonitor_favorites_v2');
          if (saved) setFavorites(JSON.parse(saved));
          refreshStatuses();
          const interval = setInterval(refreshStatuses, 30000);
          return () => clearInterval(interval);
        }, []);

        const toggleFavorite = (id) => {
          const newFavorites = favorites.includes(id) 
            ? favorites.filter(favId => favId !== id)
            : [...favorites, id];
          setFavorites(newFavorites);
          localStorage.setItem('boxmonitor_favorites_v2', JSON.stringify(newFavorites));
        };

        const refreshStatuses = async () => {
          setIsRefreshing(true);
          const updatedServers = await Promise.all(
            servers.map(async (server) => {
              const statusUpdate = await fetchServerStatus(server);
              return { ...server, ...statusUpdate };
            })
          );
          setServers(updatedServers);
          setIsRefreshing(false);
        };

        const sortedAndFilteredServers = useMemo(() => {
          let result = servers.filter(server => {
            const matchesPlayers = server.players >= filters.minPlayers;
            const matchesStatus = filters.showOffline ? true : server.status === 'online';
            const matchesSearch = server.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                                  server.ip.toLowerCase().includes(searchTerm.toLowerCase());
            return matchesPlayers && matchesStatus && matchesSearch;
          });

          return result.sort((a, b) => {
            if (sortOption === 'favorites') {
              const aFav = favorites.includes(a.id);
              const bFav = favorites.includes(b.id);
              if (aFav && !bFav) return -1;
              if (!aFav && bFav) return 1;
            }
            if (sortOption === 'name') return a.name.localeCompare(b.name);
            if (a.status === 'online' && b.status !== 'online') return -1;
            if (a.status !== 'online' && b.status === 'online') return 1;
            if (sortOption === 'online_asc') return a.players - b.players;
            return b.players - a.players;
          });
        }, [servers, sortOption, filters, searchTerm, favorites]);

        const top3Servers = useMemo(() => {
          return [...servers]
            .filter(s => s.status === 'online')
            .sort((a, b) => b.players - a.players)
            .slice(0, 3);
        }, [servers]);

        const stats = useMemo(() => ({
          totalPlayers: servers.reduce((acc, s) => acc + (s.status === 'online' ? s.players : 0), 0),
          onlineCount: servers.filter(s => s.status === 'online').length
        }), [servers]);

        return (
          <div className="min-h-screen font-sans selection:bg-purple-500/30 selection:text-white pb-20 overflow-hidden relative">
            
            <div className="fixed left-6 top-0 bottom-0 w-12 hidden 2xl:flex flex-col justify-center items-center gap-12 pointer-events-none z-0 opacity-20">
               <div className="w-px h-32 bg-gradient-to-b from-transparent via-white to-transparent"></div>
               <div className="vertical-text font-mono text-[10px] tracking-[0.4em] text-white">SYSTEM STATUS // OPTIMAL</div>
               <Hexagon size={12} className="text-white animate-pulse" />
               <div className="w-px h-32 bg-gradient-to-b from-transparent via-white to-transparent"></div>
            </div>

            <div className="fixed right-6 top-0 bottom-0 w-12 hidden 2xl:flex flex-col justify-center items-center gap-12 pointer-events-none z-0 opacity-20">
               <div className="w-px h-32 bg-gradient-to-b from-transparent via-white to-transparent"></div>
               <div className="vertical-text font-mono text-[10px] tracking-[0.4em] text-white">BOX PVP NETWORK // 2026</div>
               <Activity size={12} className="text-white animate-pulse" />
               <div className="w-px h-32 bg-gradient-to-b from-transparent via-white to-transparent"></div>
            </div>

            <div className="fixed top-6 left-0 right-0 flex justify-center z-50 pointer-events-none">
               <div className="bg-white/5 backdrop-blur-2xl border border-white/10 rounded-full px-6 py-3 flex items-center gap-6 shadow-2xl pointer-events-auto transition-transform hover:scale-[1.02]">
                  
                  <div className="flex items-center gap-4 text-xs font-medium text-white/60">
                     <div className="flex items-center gap-2">
                       <div className="w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"></div>
                       <span className="text-white">{stats.totalPlayers}</span> онлайн
                     </div>
                     <div className="w-px h-3 bg-white/10"></div>
                     <div className="flex items-center gap-2">
                       <Zap size={12} className="text-yellow-400" />
                       <span className="text-white">{stats.onlineCount}</span> активных
                     </div>
                  </div>

                  <button 
                     onClick={() => refreshStatuses()} 
                     className={`p-1.5 rounded-full hover:bg-white/10 text-white/40 hover:text-white transition-all ${isRefreshing ? 'animate-spin' : ''}`}
                  >
                     <RefreshCw size={14} />
                  </button>
               </div>
            </div>

            <main className="max-w-[1400px] mx-auto px-6 lg:px-12 pt-32">
              
              <div className="flex flex-col items-center mb-12 animate-fade-in">
                 <div className="w-full max-w-2xl relative group z-10">
                    <div className="absolute inset-0 bg-gradient-to-r from-purple-500/20 to-blue-500/20 rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-700"></div>
                    <div className="relative bg-white/[0.03] backdrop-blur-xl border border-white/10 rounded-3xl p-2 flex items-center shadow-lg transition-all group-focus-within:bg-white/[0.07] group-focus-within:border-white/20">
                       <Search className="ml-4 text-white/30" size={24} />
                       <input 
                          type="text" 
                          placeholder="Найти сервер..." 
                          value={searchTerm}
                          onChange={(e) => setSearchTerm(e.target.value)}
                          className="w-full bg-transparent border-none text-lg text-white placeholder:text-white/20 px-4 py-3 focus:outline-none font-medium"
                       />
                       
                       <div className="flex items-center gap-2 pr-2">
                          <button 
                             onClick={() => setSortOption(sortOption === 'online_desc' ? 'name' : 'online_desc')}
                             className="p-2.5 rounded-xl hover:bg-white/10 text-white/40 hover:text-white transition-colors"
                             title="Сортировка"
                          >
                             <ArrowDownUp size={18} />
                          </button>
                          <button 
                             onClick={() => setFilters(prev => ({ ...prev, showOffline: !prev.showOffline }))}
                             className={`p-2.5 rounded-xl transition-all ${filters.showOffline ? 'bg-white/10 text-white' : 'hover:bg-white/5 text-white/40'}`}
                             title="Показать оффлайн"
                          >
                             <SlidersHorizontal size={18} />
                          </button>
                       </div>
                    </div>
                 </div>
              </div>

              {!searchTerm && top3Servers.length > 0 && (
                <div className="mb-24 animate-fade-in relative">
                   <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/2 h-full bg-gradient-to-t from-purple-900/20 to-transparent blur-3xl -z-10 rounded-full"></div>

                   <div className="flex items-center justify-center gap-3 mb-10 opacity-60">
                      <Trophy size={16} className="text-yellow-500" />
                      <span className="text-xs font-mono uppercase tracking-[0.2em] text-white/80">Топ серверов</span>
                      <div className="w-12 h-px bg-gradient-to-r from-white/20 to-transparent"></div>
                   </div>
                   
                   <div className="grid grid-cols-1 md:grid-cols-3 gap-6 items-end max-w-4xl mx-auto">
                      <div className="order-2 md:order-1 opacity-90 hover:opacity-100 transition-opacity transform md:translate-y-4">
                         {top3Servers[1] && (
                           <ServerCard 
                              server={top3Servers[1]} 
                              index={1} 
                              isFavorite={favorites.includes(top3Servers[1].id)}
                              onToggleFavorite={toggleFavorite}
                              rank={2}
                           />
                         )}
                      </div>

                      <div className="order-1 md:order-2 z-10 transform md:-translate-y-6 scale-105">
                         {top3Servers[0] && (
                           <ServerCard 
                              server={top3Servers[0]} 
                              index={0} 
                              isFavorite={favorites.includes(top3Servers[0].id)}
                              onToggleFavorite={toggleFavorite}
                              rank={1}
                           />
                         )}
                      </div>

                      <div className="order-3 md:order-3 opacity-90 hover:opacity-100 transition-opacity transform md:translate-y-4">
                         {top3Servers[2] && (
                           <ServerCard 
                              server={top3Servers[2]} 
                              index={2} 
                              isFavorite={favorites.includes(top3Servers[2].id)}
                              onToggleFavorite={toggleFavorite}
                              rank={3}
                           />
                         )}
                      </div>
                   </div>
                </div>
              )}

              <div className="mb-8 flex items-center gap-4 opacity-40">
                 <div className="w-2 h-2 rounded-full bg-white"></div>
                 <span className="text-xs font-mono uppercase tracking-widest">Все серверы</span>
                 <div className="h-px flex-1 bg-white/10"></div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                {sortedAndFilteredServers.length > 0 ? (
                  sortedAndFilteredServers.map((server, index) => (
                    <ServerCard 
                      key={server.id} 
                      server={server} 
                      index={index}
                      isFavorite={favorites.includes(server.id)}
                      onToggleFavorite={toggleFavorite}
                    />
                  ))
                ) : (
                  <div className="col-span-full py-32 flex flex-col items-center justify-center text-center opacity-50">
                     <div className="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mb-6 backdrop-blur-md border border-white/5">
                        <Search size={32} className="text-white/30" />
                     </div>
                     <p className="text-white/40 font-medium font-mono">СИГНАЛ НЕ ОБНАРУЖЕН</p>
                  </div>
                )}
              </div>

            </main>
            
            <footer className="mt-40 pb-12 flex justify-center z-10">
               <a 
                  href="https://t.me/devgptai" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  className="group relative px-6 py-2 rounded-full bg-white/[0.03] backdrop-blur-md border border-white/5 hover:border-white/10 hover:bg-white/[0.06] transition-all duration-500 hover:scale-105"
               >
                  <div className="flex items-center gap-2 text-[10px] font-mono tracking-[0.2em] uppercase">
                      <span className="text-white/30 group-hover:text-white/50 transition-colors">code by</span>
                      <span className="font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-cyan-400 group-hover:drop-shadow-[0_0_10px_rgba(168,85,247,0.5)] transition-all">
                        derk
                      </span>
                  </div>
               </a>
            </footer>
          </div>
        );
      };

      const rootElement = document.getElementById('root');
      if (rootElement) {
        const root = createRoot(rootElement);
        root.render(<App />);
      }
    </script>
  </body>
</html>
